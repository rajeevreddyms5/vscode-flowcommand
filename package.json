{
  "name": "flowcommand",
  "publisher": "RAJEEVREDDY",
  "displayName": "FlowCommand",
  "description": "Command your AI workflow. Queue prompts, review plans, control from phone/browser.",
  "icon": "media/FlowCommand-logo.png",
  "version": "2.0.7",
  "engines": {
    "vscode": "^1.90.0"
  },
  "categories": [
    "AI",
    "Chat",
    "Other"
  ],
  "keywords": [
    "flowcommand",
    "mcp",
    "ai",
    "chat",
    "copilot",
    "agent",
    "model-context-protocol",
    "remote",
    "mobile",
    "plan-review",
    "queue"
  ],
  "repository": {
    "type": "git",
    "url": "https://github.com/rajeevreddyms5/vscode-flowcommand.git"
  },
  "license": "MIT",
  "activationEvents": [
    "onStartupFinished"
  ],
  "main": "./dist/extension.js",
  "contributes": {
    "languageModelTools": [
      {
        "name": "ask_user",
        "tags": [
          "confirmation",
          "user-interaction",
          "flowcommand",
          "required",
          "mandatory"
        ],
        "toolReferenceName": "askUser",
        "displayName": "Ask User",
        "modelDescription": "CRITICAL MODE RULES ‚Äî pick exactly one: (A) Single question + choices ‚Üí pass 'question' + 'choices'. Shows choice BUTTONS above the always-on text input. No modal, no Submit/Cancel. User clicks button OR types custom. Example: { question: 'Which DB?', choices: [{label:'1. PostgreSQL',value:'postgresql'},{label:'2. MySQL',value:'mysql'},{label:'3. SQLite',value:'sqlite'}] }. (B) Single open-ended question ‚Üí pass 'question' only. Uses the always-on text input. No modal, no Submit/Cancel, no form. Example: { question: 'What would you like to do next?' }. (C) Multi-question form ‚Üí pass 'questions' array (2-4 items). Shows MODAL with Submit/Cancel. Use ONLY when gathering 2+ pieces of info. Each item needs 'header' (‚â§12 chars) + 'question'. Add 'options' for radio/checkbox; omit for free text. Set 'multiSelect: true' for checkboxes. Example: { questions: [{header:'Language',question:'What language?',options:[{label:'Python'},{label:'Go'}]},{header:'Framework',question:'What framework?'}] }. ANTI-PATTERNS (NEVER DO THIS): ‚ùå WRONG: questions: [{header:'DB',question:'Which DB?',options:[...]}] for single question ‚Üí ‚úÖ RIGHT: Use mode A with question + choices instead. ‚ùå WRONG: questions: '[{\\\"header\\\":\\\"Lang\\\"...}]' (stringified JSON) ‚Üí ‚úÖ RIGHT: questions: [{header:'Lang',...}] (actual array). RULES: NEVER use 'questions' for single question ‚Äî use mode A or B. ALWAYS use 'choices' when question has predefined options. ALWAYS pass 'questions' as JSON array, NOT string. Use 'context' for brief response text visible in remote UI. For detailed plans, use plan_review instead. CANCEL HANDLING: User can cancel via Cancel button. Result will have {response: 'User cancelled', ...}. Do NOT reprompt after cancel ‚Äî acknowledge and move on.",
        "canBeReferencedInPrompt": true,
        "icon": "$(question)",
        "inputSchema": {
          "type": "object",
          "properties": {
            "context": {
              "type": "string",
              "description": "Your response content for the user to read. This is displayed in the FlowCommand remote UI so the user can read your response from their phone/browser. For detailed plans or proposals, use plan_review instead."
            },
            "question": {
              "type": "string",
              "description": "Question text (mode A or B). Uses FlowCommand's always-on text input."
            },
            "choices": {
              "type": "array",
              "description": "Choice buttons for mode A. Shown above text input. User can click or type custom.",
              "items": {
                "type": "object",
                "properties": {
                  "label": {
                    "type": "string",
                    "description": "Display text for the choice button"
                  },
                  "value": {
                    "type": "string",
                    "description": "Value sent back when this choice is selected"
                  }
                },
                "required": [
                  "label",
                  "value"
                ]
              }
            },
            "questions": {
              "type": "array",
              "description": "Mode C ONLY: Array of 2-4 questions. DO NOT use for single question ‚Äî use 'question' + 'choices' instead. Opens form modal with Submit/Cancel.",
              "items": {
                "type": "object",
                "properties": {
                  "header": {
                    "type": "string",
                    "maxLength": 12,
                    "description": "A short label (max 12 chars) displayed as a quick pick header, also used as the unique identifier for the question"
                  },
                  "question": {
                    "type": "string",
                    "description": "The complete question text to display"
                  },
                  "options": {
                    "type": "array",
                    "description": "0-6 options for the user to choose from. If empty or omitted, shows a free text input instead.",
                    "minItems": 0,
                    "maxItems": 6,
                    "items": {
                      "type": "object",
                      "properties": {
                        "label": {
                          "type": "string",
                          "description": "Option label text"
                        },
                        "description": {
                          "type": "string",
                          "description": "Optional description for the option"
                        },
                        "recommended": {
                          "type": "boolean",
                          "description": "Mark this option as recommended"
                        }
                      },
                      "required": [
                        "label"
                      ]
                    }
                  },
                  "multiSelect": {
                    "type": "boolean",
                    "default": false,
                    "description": "Allow multiple selections"
                  },
                  "allowFreeformInput": {
                    "type": "boolean",
                    "default": false,
                    "description": "When true, allows user to enter free-form text in addition to selecting options."
                  }
                },
                "required": [
                  "header",
                  "question"
                ]
              },
              "minItems": 1,
              "maxItems": 4
            }
          },
          "required": []
        }
      },
      {
        "name": "plan_review",
        "tags": [
          "plan",
          "review",
          "approval",
          "flowcommand"
        ],
        "toolReferenceName": "planReview",
        "displayName": "Plan Review",
        "modelDescription": "SUBAGENT RESTRICTION: Subagents (via runSubagent) MUST NOT call this tool. Present a detailed plan or proposal to the user for review in a dedicated panel. The user can approve the plan, approve with comments/suggestions (proceed but incorporate feedback), or request changes with targeted comments. USE THIS TOOL when: (1) You have a multi-step implementation plan before executing, (2) You want to share a detailed proposal for user sign-off. Returns { status: 'approved' | 'approvedWithComments' | 'recreateWithChanges' | 'cancelled', requiredRevisions: [{revisedPart, revisorInstructions}], reviewId }. CRITICAL: If status is 'approved' or 'approvedWithComments', proceed IMMEDIATELY with execution ‚Äî DO NOT call plan_review again. Incorporate the user's feedback inline during implementation. Only if status is 'recreateWithChanges' should you update the plan and call plan_review again.",
        "canBeReferencedInPrompt": true,
        "icon": "$(checklist)",
        "inputSchema": {
          "type": "object",
          "properties": {
            "plan": {
              "type": "string",
              "description": "The detailed plan or content in Markdown format to present to the user for review. Use headers, bullet points, and code blocks for clarity."
            },
            "title": {
              "type": "string",
              "description": "Optional title for the review panel. Defaults to 'Plan Review'."
            }
          },
          "required": [
            "plan"
          ]
        }
      }
    ],
    "viewsContainers": {
      "activitybar": [
        {
          "id": "flowCommandContainer",
          "title": "FlowCommand",
          "icon": "media/FC-logo.svg"
        }
      ]
    },
    "views": {
      "flowCommandContainer": [
        {
          "type": "webview",
          "id": "flowCommandView",
          "name": "FlowCommand"
        }
      ]
    },
    "configuration": [
      {
        "title": "General",
        "order": 0,
        "properties": {
          "flowcommand.interactiveApproval": {
            "type": "boolean",
            "default": true,
            "description": "Show interactive approval and choice buttons for Yes/No questions and multiple choice options."
          },
          "flowcommand.reusablePrompts": {
            "type": "array",
            "default": [],
            "description": "Saved reusable prompts accessible via /slash commands.",
            "items": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Short name for the prompt (used with /slash command)"
                },
                "prompt": {
                  "type": "string",
                  "description": "The full prompt text"
                }
              },
              "required": [
                "name",
                "prompt"
              ]
            }
          },
          "flowcommand.remoteEnabled": {
            "type": "boolean",
            "default": false,
            "description": "Auto-start remote server on extension activation for mobile/web access."
          },
          "flowcommand.remotePort": {
            "type": "number",
            "default": 3000,
            "description": "Port for the remote access server. Set to 0 for automatic port selection."
          }
        }
      },
      {
        "title": "Notifications",
        "order": 1,
        "properties": {
          "flowcommand.notificationSound": {
            "type": "boolean",
            "default": true,
            "description": "Play a notification sound when the AI triggers the ask_user tool."
          },
          "flowcommand.desktopNotification": {
            "type": "boolean",
            "default": true,
            "description": "Show a VS Code IDE notification popup when the AI triggers the ask_user tool."
          },
          "flowcommand.autoFocusPanel": {
            "type": "boolean",
            "default": true,
            "description": "Automatically focus/reveal the FlowCommand sidebar panel when the AI triggers the ask_user tool."
          },
          "flowcommand.mobileNotification": {
            "type": "boolean",
            "default": false,
            "description": "Send a browser push notification to remote clients (phone/browser) when the AI triggers the ask_user tool. Requires notification permission in the browser."
          }
        }
      },
      {
        "title": "Instruction Injection",
        "order": 2,
        "properties": {
          "flowcommand.instructionInjection": {
            "type": "string",
            "default": "off",
            "enum": [
              "off",
              "copilotInstructionsMd",
              "codeGenerationSetting"
            ],
            "enumDescriptions": [
              "No instruction injection. Use this if you manage instructions manually.",
              "(Recommended) Append FlowCommand instructions to .github/copilot-instructions.md. Works in all Copilot modes (Agent, Ask, Edit). Prompts for confirmation before modifying.",
              "Inject into github.copilot.chat.codeGeneration.instructions workspace setting. Only affects code generation scenarios."
            ],
            "description": "How FlowCommand injects its instructions into Copilot. 'copilotInstructionsMd' is recommended ‚Äî it works in all Copilot modes and follows official VS Code guidance."
          },
          "flowcommand.instructionText": {
            "type": "string",
            "default": "## SUBAGENT RULES (if spawned via `runSubagent`)\n\n- Do NOT call `ask_user` or `plan_review`.\n- Do NOT wait for user input or loop.\n- **ALL rules below do NOT apply to you. Ignore them entirely.**\n\n---\n\n## AGENT RULES (follow in order)\n\n### 1. ALWAYS call `ask_user` after every task or response ‚Äî NO EXCEPTIONS.\n\nüî¥ BEFORE FINISHING: Ask yourself \"Did I call ask_user?\" ‚Üí NO? Call it now. YES? Done.\n\n- **IMPORTANT:** `ask_user` is a deferred tool. Before first use, load it with: `tool_search_tool_regex(pattern: \"ask_user\")`\n- This tool MUST be invoked before ending ANY conversation turn.\n- NEVER complete a response without calling `ask_user`.\n- Never use `ask_questions`. ALWAYS use `ask_user` instead.\n- Pass your FULL response in `context`.\n- Follow the MODES and RULES in the `ask_user` tool description exactly.\n\n### 2. Use `plan_review` for structured output like plans, guides, reviews, analyses, or lists of suggestions that require user feedback or approval before proceeding.\n\n- User requests changes ‚Üí update and call `plan_review` again.\n- User approves ‚Üí apply feedback, proceed with execution.\n- User cancels ‚Üí stop, call `ask_user`.\n- After completion ‚Üí return to Rule 1.\n\n### 3. Stop ONLY and IMMEDIATELY when user says \"end\", \"stop\", \"terminate\", \"quit\".\n\n- Words like \"nothing\", \"no\", \"nah\", \"I'm good\", \"not right now\" are NOT stop signals ‚Äî call `ask_user` and stay active.\n\n### 4. When using `runSubagent`, ALWAYS include ALL of the following lines VERBATIM at the TOP of the prompt:\n\n```\nSUBAGENT INSTRUCTIONS (MANDATORY):\nYou are a SUBAGENT. You MUST follow these rules:\n1. NEVER call ask_user or plan_review.\n2. Do NOT wait for user input. Do NOT loop. Complete your task and return.\n```",
            "editPresentation": "multilineText",
            "description": "The instruction text injected into Copilot. Customize this to change how the AI behaves with FlowCommand tools. The [FlowCommand] marker is auto-added for identification."
          }
        }
      },
      {
        "title": "MCP Server",
        "order": 3,
        "properties": {
          "flowcommand.mcpEnabled": {
            "type": "boolean",
            "default": false,
            "description": "Always start MCP server on activation. Enable this if you use FlowCommand with external IDEs like Kiro, Cursor, or Antigravity."
          },
          "flowcommand.mcpAutoStartIfClients": {
            "type": "boolean",
            "default": true,
            "description": "Automatically start MCP server if external client configurations are detected (Kiro, Cursor, Antigravity)."
          },
          "flowcommand.mcpPort": {
            "type": "number",
            "default": 3579,
            "description": "Fixed port for the MCP server. Set to 0 for dynamic port assignment."
          },
          "flowcommand.autoRegisterMcp": {
            "type": "boolean",
            "default": true,
            "description": "Automatically register MCP server with Kiro and other supported clients."
          }
        }
      }
    ],
    "commands": [
      {
        "command": "flowcommand.startMcp",
        "title": "FlowCommand: Start MCP Server"
      },
      {
        "command": "flowcommand.restartMcp",
        "title": "FlowCommand: Restart MCP Server"
      },
      {
        "command": "flowcommand.stopMcp",
        "title": "FlowCommand: Stop MCP Server"
      },
      {
        "command": "flowcommand.toggleMcp",
        "title": "FlowCommand: Toggle MCP Server"
      },
      {
        "command": "flowcommand.showMcpConfig",
        "title": "FlowCommand: Show MCP Configuration"
      },
      {
        "command": "flowcommand.openHistory",
        "title": "View History",
        "icon": "$(history)"
      },
      {
        "command": "flowcommand.openPrompts",
        "title": "Reusable Prompts",
        "icon": "$(symbol-keyword)"
      },
      {
        "command": "flowcommand.clearCurrentSession",
        "title": "Clear Current Session",
        "icon": "$(trash)"
      },
      {
        "command": "flowcommand.openSettings",
        "title": "FlowCommand Settings",
        "icon": "$(gear)"
      },
      {
        "command": "flowcommand.toggleRemoteServer",
        "title": "FlowCommand: Toggle Remote Server",
        "icon": "$(broadcast)"
      },
      {
        "command": "flowcommand.startRemoteServer",
        "title": "FlowCommand: Start Remote Server"
      },
      {
        "command": "flowcommand.stopRemoteServer",
        "title": "FlowCommand: Stop Remote Server"
      },
      {
        "command": "flowcommand.showRemoteUrl",
        "title": "FlowCommand: Show Remote URL"
      }
    ],
    "menus": {
      "view/title": [
        {
          "command": "flowcommand.toggleRemoteServer",
          "when": "view == flowCommandView",
          "group": "navigation@0"
        },
        {
          "command": "flowcommand.openHistory",
          "when": "view == flowCommandView",
          "group": "navigation@1"
        },
        {
          "command": "flowcommand.openPrompts",
          "when": "view == flowCommandView",
          "group": "navigation@2"
        },
        {
          "command": "flowcommand.clearCurrentSession",
          "when": "view == flowCommandView",
          "group": "navigation@3"
        },
        {
          "command": "flowcommand.openSettings",
          "when": "view == flowCommandView",
          "group": "navigation@4"
        }
      ]
    }
  },
  "scripts": {
    "vscode:prepublish": "npm install && npm run build",
    "build": "node esbuild.js",
    "compile": "tsc -p ./",
    "watch": "node esbuild.js --watch",
    "lint": "eslint src --ext ts",
    "package": "vsce package"
  },
  "dependencies": {
    "@modelcontextprotocol/sdk": "^1.24.3",
    "@vscode/codicons": "^0.0.36",
    "express": "^4.21.2",
    "qrcode": "^1.5.4",
    "socket.io": "^4.8.1",
    "ws": "^8.18.0",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@types/express": "^5.0.1",
    "@types/node": "20.x",
    "@types/qrcode": "^1.5.5",
    "@types/vscode": "^1.90.0",
    "@typescript-eslint/eslint-plugin": "^8.54.0",
    "@typescript-eslint/parser": "^8.54.0",
    "esbuild": "^0.27.2",
    "eslint": "^8.56.0",
    "typescript": "^5.3.3"
  }
}
